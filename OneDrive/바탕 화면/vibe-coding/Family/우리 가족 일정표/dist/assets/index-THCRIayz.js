(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();const me="family-calendar-events-v1",Ce=2025,Se=10,fe={yunhee:{label:"윤희",colorVar:"--yunhee"},eon:{label:"이언",colorVar:"--eon"},taeeun:{label:"태은",colorVar:"--taeeun"},ando:{label:"안도",colorVar:"--ando"},family:{label:"가족",colorVar:"--family"},etc:{label:"기타",colorVar:"--etc"}},ye=[{id:"rec-yunhee-birthday",title:"윤희 생일",category:"yunhee",type:"solar",month:5,day:7,order:10},{id:"rec-eon-birthday",title:"이언 생일",category:"eon",type:"solar",month:3,day:29,order:20},{id:"rec-taeeun-birthday",title:"태은 생일",category:"taeeun",type:"solar",month:5,day:12,order:30},{id:"rec-wedding-anniversary",title:"결혼 기념일",category:"family",type:"solar",month:2,day:21,order:40},{id:"rec-ando-birthday",title:"안도 생일",category:"ando",type:"solar",month:3,day:2,order:50},{id:"rec-daegu-grandma-birthday",title:"대구 할머니 생신",category:"family",type:"solar",month:8,day:24,order:60},{id:"rec-daegu-grandpa-memorial",title:"대구 할아버지 기일",category:"family",type:"lunar",month:2,day:28,order:70},{id:"rec-gangneung-grandpa-birthday",title:"강릉 할아버지 생신",category:"family",type:"lunar",month:9,day:24,order:80},{id:"rec-gangneung-grandma-birthday",title:"강릉 할머니 생신",category:"family",type:"solar",month:12,day:9,order:90},{id:"rec-gangneung-uncle-birthday",title:"강릉 외삼촌 생일",category:"family",type:"solar",month:10,day:1,order:100},{id:"rec-daegu-aunt-birthday",title:"대구 고모 생일",category:"family",type:"solar",month:4,day:26,order:110}],ke=new Set(ye.map(e=>e.id)),ge=["월","화","수","목","금","토","일"],we=[{month:1,day:1,name:"신정"},{month:3,day:1,name:"삼일절"},{month:5,day:5,name:"어린이날"},{month:6,day:6,name:"현충일"},{month:8,day:15,name:"광복절"},{month:10,day:3,name:"개천절"},{month:10,day:9,name:"한글날"},{month:12,day:25,name:"성탄절"}],Be=new Intl.DateTimeFormat("ko-u-ca-chinese",{month:"numeric",day:"numeric"}),ae=document.getElementById("weekday-row"),oe=document.getElementById("date-grid"),Re=document.getElementById("current-month-label"),xe=document.getElementById("prev-month"),Ae=document.getElementById("next-month"),Me=document.getElementById("share-link-btn"),Oe=document.getElementById("export-json-btn"),Te=document.getElementById("import-json-btn"),U=document.getElementById("import-json-input"),w=document.getElementById("event-modal"),Ne=document.getElementById("modal-close"),$e=document.getElementById("modal-date-label"),he=document.getElementById("event-form"),S=document.getElementById("event-category"),q=document.getElementById("event-title"),H=document.getElementById("event-notes"),E=document.getElementById("event-image"),re=document.getElementById("event-image-status"),l=document.getElementById("event-image-remove"),F=document.getElementById("event-list"),V=document.getElementById("delete-all-btn"),B=document.getElementById("attendance-card"),J=document.getElementById("attendance-yunhee-dropoff"),_=document.getElementById("attendance-yunhee-pickup"),G=document.getElementById("attendance-taeeun-dropoff"),K=document.getElementById("attendance-taeeun-pickup"),W=document.getElementById("attendance-notes"),je=document.getElementById("attendance-save"),Fe=document.getElementById("attendance-clear"),ce=document.getElementById("attendance-status"),Pe=document.getElementById("event-item-template"),pe=he.querySelector(".primary"),r={currentDate:new Date(Ce,Se,1),events:{},attendance:{},selectedDate:null,editingEventId:null};Ue();function Ue(){Ve(),qe(),Ye(),b()}function Ve(){ae.innerHTML="",ge.forEach(e=>{const t=document.createElement("span");t.textContent=e,ae.appendChild(t)})}function Ye(){xe.addEventListener("click",()=>de(-1)),Ae.addEventListener("click",()=>de(1)),Me.addEventListener("click",tt),Oe.addEventListener("click",nt),Te.addEventListener("click",()=>U.click()),U.addEventListener("change",at),Ne.addEventListener("click",P),w.addEventListener("click",e=>{e.target===w&&P()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&!w.hasAttribute("hidden")&&P()}),he.addEventListener("submit",Xe),V.addEventListener("click",et),E.addEventListener("change",De),l.addEventListener("change",We),je.addEventListener("click",dt),Fe.addEventListener("click",st)}function qe(){const e=He();if(e){Y(e),I();return}try{const t=localStorage.getItem(me);if(t){const n=JSON.parse(t);Y(n)}}catch(t){console.warn("저장된 일정 데이터를 불러오지 못했습니다.",t)}}function Y(e){!e||typeof e!="object"||("events"in e||"attendance"in e?(r.events=e.events&&typeof e.events=="object"?e.events:{},r.attendance=e.attendance&&typeof e.attendance=="object"?e.attendance:{}):(r.events=e,r.attendance={}))}function I(){try{const e=X();localStorage.setItem(me,JSON.stringify(e))}catch(e){console.warn("일정 데이터를 저장하지 못했습니다.",e)}}function He(){const t=new URLSearchParams(window.location.search).get("data");if(!t)return null;try{const n=ct(t),a=JSON.parse(n);if(a&&typeof a=="object")return a}catch(n){console.warn("공유 링크에서 데이터를 읽을 수 없습니다.",n)}return null}function Je(e){const t=JSON.stringify(e);return rt(t)}function de(e){const t=r.currentDate.getFullYear(),n=r.currentDate.getMonth();r.currentDate=new Date(t,n+e,1),b()}function b(){const e=r.currentDate.getFullYear(),t=r.currentDate.getMonth();Re.textContent=`${e}년 ${t+1}월`;const a=(new Date(e,t,1).getDay()+6)%7,o=42,d=ue(new Date);oe.innerHTML="";for(let u=0;u<o;u+=1){const s=new Date(e,t,1-a+u),h=s.getMonth()===t,f=ue(s),{lunarDay:p,lunarMonth:v}=z(s),T=p===1||p===10||p===20,L=ve(s,{lunarDay:p,lunarMonth:v}),ee=be(f,s,{lunarDay:p,lunarMonth:v}),y=document.createElement("div");y.classList.add("day-cell"),h||y.classList.add("other-month"),f===d&&y.classList.add("today");const te=s.getDay();h&&(te===6&&y.classList.add("saturday"),te===0&&y.classList.add("sunday"),L.length>0&&y.classList.add("holiday-day"));const A=document.createElement("div");A.classList.add("date-label");const N=document.createElement("span");if(N.classList.add("gregorian"),N.textContent=String(s.getDate()),A.appendChild(N),T&&v){const i=document.createElement("span");i.classList.add("lunar"),i.textContent=`음 ${v}월 ${p}일`,A.appendChild(i)}const C=document.createElement("button");C.type="button",C.classList.add("add-overlay"),C.dataset.date=f,C.setAttribute("aria-label",`${s.getFullYear()}년 ${s.getMonth()+1}월 ${s.getDate()}일 일정 추가`),C.addEventListener("click",()=>Qe(f));const $=document.createElement("div");$.classList.add("badges"),L.forEach(i=>{const g=document.createElement("span");g.classList.add("badge"),g.textContent=i,$.appendChild(g)});const j=document.createElement("div");j.classList.add("events"),ee.forEach(i=>{const g=document.createElement("span");g.classList.add("event-chip"),i.isRecurring&&g.classList.add("recurring"),i.imageData&&g.classList.add("has-image"),g.style.backgroundColor=Ee(i.category),g.title=i.isRecurring?`${i.title} · 반복 일정`:i.title;const ne=document.createElement("span");ne.textContent=i.title,g.appendChild(ne),j.appendChild(g)}),y.appendChild(A),L.length>0&&y.appendChild($),ee.length>0&&y.appendChild(j),y.appendChild(C),oe.appendChild(y)}}function Ee(e){const t=document.documentElement,n=fe[e];return n&&getComputedStyle(t).getPropertyValue(n.colorVar)||"var(--border)"}function z(e){const t=Be.formatToParts(e),n=t.find(o=>o.type==="month"),a=t.find(o=>o.type==="day");return{lunarMonth:n?Number(n.value):null,lunarDay:a?Number(a.value):null}}function ve(e,t){const n=[],a=e.getMonth()+1,o=e.getDate();we.forEach(u=>{u.month===a&&u.day===o&&n.push(u.name)});const{lunarMonth:c,lunarDay:d}=t;return c&&d&&(c===1&&d===1&&n.push("설날"),c===12&&(d===29||d===30)&&n.push("설날 연휴"),c===1&&d===2&&n.push("설날 연휴"),c===4&&d===8&&n.push("부처님오신날"),c===8&&d===15&&n.push("추석"),c===8&&(d===14||d===16)&&n.push("추석 연휴")),n}function be(e,t,n){const a=_e(t,n),o=(r.events[e]||[]).map(c=>({...c,isRecurring:!1}));return Ge([...a,...o])}function _e(e,t){const n=e.getMonth()+1,a=e.getDate();return ye.filter(o=>o.type==="solar"?o.month===n&&o.day===a:o.type==="lunar"?t.lunarMonth===o.month&&t.lunarDay===o.day:!1).map(o=>({id:o.id,title:o.title,category:o.category,notes:o.notes||"",isRecurring:!0,order:o.order??0}))}function Ge(e){return e.slice().sort((t,n)=>{if(t.isRecurring!==n.isRecurring)return t.isRecurring?-1:1;if(t.isRecurring&&n.isRecurring)return(t.order??0)-(n.order??0);const a=t.createdAt??0,o=n.createdAt??0;return a!==o?a-o:(t.title||"").localeCompare(n.title||"")})}function se({category:e,title:t,notes:n,imageData:a}){const o={id:ot(),category:e,title:t,createdAt:Date.now()};return n&&(o.notes=n),a&&(o.imageData=a),o}function x(){r.editingEventId=null,pe.textContent="저장",S.value="",q.value="",H.value="",E.value="",l.checked=!1,l.disabled=!0,R("이미지가 첨부되지 않았습니다.")}function Ke(e){r.editingEventId=e.id,pe.textContent="수정 저장",S.value=e.category,q.value=e.title,H.value=e.notes||"",E.value="",l.checked=!1,l.disabled=!e.imageData,R(e.imageData?"기존 이미지가 첨부되어 있습니다.":"이미지가 첨부되지 않았습니다."),k(),S.focus()}function R(e){re&&(re.textContent=e)}function De(){const e=E.files&&E.files[0]?E.files[0]:null;if(e)R(`선택된 이미지: ${e.name}`),l.checked=!1,l.disabled=!1;else{const t=r.editingEventId&&!l.disabled;t||(l.disabled=!0,l.checked=!1),R(t?"기존 이미지가 첨부되어 있습니다.":"이미지가 첨부되지 않았습니다.")}}function We(){l.disabled||(l.checked?(E.value="",R("이미지를 삭제하도록 설정했습니다.")):De())}function ze(e){return new Promise((t,n)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=()=>n(a.error||new Error("파일을 읽을 수 없습니다.")),a.readAsDataURL(e)})}function Qe(e){r.selectedDate=e,w.removeAttribute("hidden"),document.body.style.overflow="hidden";const t=Q(e),n=ge[(t.getDay()+6)%7];$e.textContent=`${t.getFullYear()}년 ${t.getMonth()+1}월 ${t.getDate()}일 (${n})`,x(),k(),O(M()),S.focus()}function P(){w.setAttribute("hidden",""),document.body.style.overflow="",r.selectedDate=null,x(),Le()}function k(){const e=r.selectedDate;if(!e)return;const t=Q(e),n=z(t),a=be(e,t,n),o=r.events[e]||[];if(F.innerHTML="",a.length===0){const c=document.createElement("p");c.textContent="등록된 일정이 없습니다.",c.classList.add("empty"),F.appendChild(c),V.disabled=!0;return}a.forEach(c=>{const d=Pe.content.firstElementChild.cloneNode(!0),u=d.querySelector(".event-marker"),s=d.querySelector(".event-title"),m=d.querySelector(".event-image"),h=d.querySelector(".event-notes"),f=d.querySelector(".event-category-label"),p=d.querySelector(".edit-btn"),v=d.querySelector(".delete-btn"),T=Ee(c.category);u.style.backgroundColor=T,s.textContent=c.title,c.imageData?(m.src=c.imageData,m.alt=`${c.title} 이미지`,m.hidden=!1):(m.removeAttribute("src"),m.hidden=!0),c.notes?(h.textContent=c.notes,h.hidden=!1):(h.hidden=!0,h.textContent="");const L=fe[c.category]?.label||"기타";f.textContent=c.isRecurring?`${L} · 반복`:L,c.isRecurring?(d.classList.add("recurring"),p.hidden=!0,p.disabled=!0,v.hidden=!0,v.disabled=!0):(p.addEventListener("click",()=>Ke(c)),v.addEventListener("click",()=>Ze(c.id)),r.editingEventId===c.id&&d.classList.add("editing")),F.appendChild(d)}),V.disabled=o.length===0}async function Xe(e){if(e.preventDefault(),!r.selectedDate)return;const t=S.value,n=q.value.trim(),a=H.value.trim(),o=E.files&&E.files[0]?E.files[0]:null,c=l.checked&&!o;if(!t||!n){alert("구분과 제목을 입력해 주세요.");return}let d=null;if(o)try{d=await ze(o)}catch(m){console.warn("이미지를 읽을 수 없습니다.",m),alert("이미지 파일을 불러오지 못했습니다. 다른 파일을 선택해 주세요.");return}const u=r.selectedDate,s=r.events[u]||[];if(r.editingEventId){const m=s.findIndex(h=>h.id===r.editingEventId);if(m!==-1){const f={...s[m],category:t,title:n,updatedAt:Date.now()};a?f.notes=a:delete f.notes,d!==null?f.imageData=d:c&&delete f.imageData,s[m]=f}else s.push(se({category:t,title:n,notes:a,imageData:d}))}else s.push(se({category:t,title:n,notes:a,imageData:d}));r.events[u]=s,I(),b(),x(),k(),S.focus()}function Ze(e){if(ke.has(e))return;const t=r.selectedDate;if(!t)return;const a=(r.events[t]||[]).filter(o=>o.id!==e);r.events[t]=a,a.length===0&&delete r.events[t],r.editingEventId===e&&x(),I(),b(),k()}function et(){!r.selectedDate||!r.events[r.selectedDate]||!confirm("이 날짜의 모든 일정을 삭제하시겠어요?")||(delete r.events[r.selectedDate],x(),I(),b(),k())}function tt(){const e=Je(X()),t=new URL(window.location.href);t.searchParams.set("data",e);const n=t.toString();navigator.share?navigator.share({title:"이언이네 일정표",text:"이언이네 일정표를 공유합니다.",url:n}).catch(()=>ie(n)):ie(n)}function ie(e){navigator.clipboard?navigator.clipboard.writeText(e).then(()=>alert("공유 링크를 복사했습니다.")).catch(()=>le(e)):le(e)}function le(e){const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.select();try{document.execCommand("copy"),alert("공유 링크를 복사했습니다.")}catch{alert(`링크 복사에 실패했습니다. 아래 주소를 직접 복사해 주세요.
`+e)}finally{document.body.removeChild(t)}}function nt(){const e=new Blob([JSON.stringify(X(),null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;const a=new Date().toISOString().split("T")[0];n.download=`family-calendar-${a}.json`,n.click(),URL.revokeObjectURL(t)}function at(e){const t=e.target.files?.[0];if(!t)return;const n=new FileReader;n.onload=()=>{try{const a=JSON.parse(n.result);if(!a||typeof a!="object")throw new Error("데이터 형식이 올바르지 않습니다.");Y(a),I(),b(),r.selectedDate&&(k(),O(M())),alert("일정 데이터를 불러왔습니다.")}catch(a){alert("일정 데이터를 불러올 수 없습니다. 파일을 확인해주세요."),console.warn(a)}finally{U.value=""}},n.readAsText(t)}function ue(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${a}`}function Q(e){const[t,n,a]=e.split("-").map(Number);return new Date(t,n-1,a)}function ot(){return`${Date.now()}-${Math.random().toString(16).slice(2,10)}`}function rt(e){const n=new TextEncoder().encode(e);let a="";return n.forEach(o=>{a+=String.fromCharCode(o)}),btoa(a)}function ct(e){const t=atob(e),n=Uint8Array.from(t,o=>o.charCodeAt(0));return new TextDecoder().decode(n)}function X(){return{events:r.events,attendance:r.attendance}}function M(){if(!r.selectedDate)return null;const e=Q(r.selectedDate),t=z(e),n=ve(e,t);return{isoDate:r.selectedDate,dateObj:e,lunarInfo:t,holidays:n}}function Ie(e){if(!e)return!1;const t=e.dateObj.getDay();return t===0||t===6?!1:e.holidays.length===0}function O(e){if(!B)return;if(!e){Le();return}if(!Ie(e)){Z(),B.hidden=!0,D("");return}const t=r.attendance[e.isoDate]||{},n=t.yunhee||{},a=t.taeeun||{};B.hidden=!1,J.checked=!!n.dropoff,_.checked=!!n.pickup,G.checked=!!a.dropoff,K.checked=!!a.pickup,W.value=t.notes||"",D("")}function Z(){J.checked=!1,_.checked=!1,G.checked=!1,K.checked=!1,W.value=""}function Le(){B&&(Z(),B.hidden=!0,D(""))}function dt(){const e=M();if(!e)return;if(!Ie(e)){D("주말과 공휴일에는 출석을 기록하지 않습니다.");return}const t=W.value.trim(),n={yunhee:{dropoff:J.checked,pickup:_.checked},taeeun:{dropoff:G.checked,pickup:K.checked}};n.yunhee.dropoff||n.yunhee.pickup||n.taeeun.dropoff||n.taeeun.pickup||t.length>0?(t&&(n.notes=t),r.attendance[e.isoDate]=n,D("출석 정보를 저장했습니다.")):(delete r.attendance[e.isoDate],D("출석 기록을 삭제했습니다.")),I(),b(),O(e)}function st(){const e=M();e&&(delete r.attendance[e.isoDate],Z(),D("출석 기록을 초기화했습니다."),I(),b(),O(e))}function D(e){ce&&(ce.textContent=e)}
